CREATE TABLE "user" (
	"userID"	TEXT NOT NULL,
	"username"	TEXT NOT NULL,
	"password"	TEXT NOT NULL,
	"email"		TEXT NOT NULL,
	"reg_date" 	DATETIME NOT NULL,
	"role"		ENUM('admin','user'),
	"verified_user" ENUM('yes','no'),
	PRIMARY KEY("userID")
);

CREATE TABLE "user_copy" (
	"userID_copy"	TEXT NOT NULL,
	"username_copy"	TEXT NOT NULL,
	"password_copy"	TEXT NOT NULL,
	"email_copy"	TEXT NOT NULL,
	"reg_date_copy" DATETIME,
	"role_copy"		ENUM('admin','user'),
	"verified_user_copy" ENUM('yes','no'),
);

CREATE TABLE "logs"(
	"userID"		TEXT NOT NULL,
	"logDate"		DATETIME NOT NULL,
	CONSTRAINT usrlog
	FOREIGN KEY("userID") REFERENCES user("userID")
	ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE "upload_num"(
	"userID"		TEXT NOT NULL,
	"data_count"	INT	NOT NULL DEFAULT 0,
	CONSTRAINT upInfo
	FOREIGN KEY("userID") REFERENCES user("userID")
	ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE "location"(
	"userID"			TEXT NOT NULL,
	"dataID"			INT NOT NULL DEFAULT 0,
	"locationID"		INT NOT NULL DEFAULT 0,
	"timestampMs"		BIGINT NOT NULL,
	"latitudeE7"		BIGINT NOT NULL,
	"longitudeE7"		BIGINT NOT NULL,
	"velocity"			INT NOT NULL,
	"accuracy"			INT NOT NULL,
	"heading"			INT NOT NULL,
	"uploadDate"		DATETIME NOT NULL, --8a ginetai update molis arxisei upload enos json
	PRIMARY KEY ("userID","dataID","locationID"),
	CONSTRAINT uplDate
	FOREIGN KEY("uploadDate") REFERENCES upload_log("date")
	ON DELETE CASCADE ON UPDATE CASCADE,
	CONSTRAINT usrIDtoUser
	FOREIGN KEY("userID") REFERENCES user("userID")
	ON DELETE CASCADE ON UPDATE CASCADE
);


CREATE TABLE activity(
	"userID"			TEXT NOT NULL,
	"dataID"			INT NOT NULL,
	"locationID"		INT NOT NULL,
	"activityID"		INT NOT NULL,
	"activity.type"		ENUM('IN_VEHICLE','ON_BICYCLE','ON_FOOT','RUNNING','STILL,TILTING','UNKNOWN','WALKING') DEFAULT UNKNOWN,
	"confidence"		INT(3) NOT NULL DEFAULT 0,
	"timestampMs"		BIGINT NOT NULL,
	"father_activity"	INT NULL,
	"uploadDate"		DATETIME NOT NULL, --8a ginetai update molis arxisei upload enos json
	PRIMARY KEY ("userID","dataID","locationID","activityID"),
	CONSTRAINT uploadDateTime
	FOREIGN KEY("uploadDate") REFERENCES upload_log("date")		
	ON DELETE CASCADE ON UPDATE CASCADE,
	CONSTRAINT userIDtoUSER
	FOREIGN KEY ("userID") REFERENCES user("userID")
	ON DELETE CASCADE ON UPDATE CASCADE,
	CONSTRAINT dataIDtoLoc
	FOREIGN KEY (dataID) REFERENCES location(dataID)
	ON DELETE CASCADE ON UPDATE CASCADE,
	CONSTRAINT locIDtoLoc
	FOREIGN KEY (locationID) REFERENCES location(locationID)
	ON DELETE CASCADE ON UPDATE CASCADE,
	CONSTRAINT arxikoActivityToActivity
	FOREIGN KEY ("userID","dataID","locationID","father_activity") REFERENCES activity("userID","dataID","locationID","activityID")
	ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE activity_copy(
	"userID"			TEXT NOT NULL,
	"dataID"			INT NOT NULL,
	"locationID"		INT NOT NULL,
	"activityID"		INT NOT NULL,
	"activity.type"		ENUM('IN_VEHICLE','ON_BICYCLE','ON_FOOT','RUNNING','STILL,TILTING','UNKNOWN','WALKING') DEFAULT UNKNOWN,
	"confidence"		INT(3) NOT NULL DEFAULT 0,
	"timestampMs"		BIGINT NOT NULL,
	"father_activity"	INT NULL,
	"uploadDate"		DATETIME NOT NULL
);

CREATE TABLE "upload_log"( --EMPERIEXEI TO UPLOAD INFO GENIKA TOU XRHSTH KAI META 8A KANEI SELECT KAI EPANALHPTIKA APO PHP 8A BAZEI TO DATE AUTO STO LOC KAI STO ACTIVITY
	"userID"	TEXT NOT NULL,
	"date"		DATETIME NOT NULL,
	"fileName"	TEXT NOT NULL,
	PRIMARY KEY ("userID"),
	CONSTRAINT upLogInfo
	FOREIGN KEY("userID") REFERENCES user("userID")
	ON DELETE CASCADE ON UPDATE CASCADE
);


CREATE TABLE history(
	"username"	VARCHAR(12) NOT NULL,
	"date"		DATETIME,
	"executed"	ENUM('Yes', 'No'),
	"type"		ENUM('insert', 'update', 'delete'),
	"tableName"	VARCHAR(15)
);

